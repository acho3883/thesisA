-- List with all user profiles when conditions met --
SELECT *
FROM core_user_profiles

WHERE core_user_profiles.user_id IN
(
-- Extract users with groups --
SELECT DISTINCT user_id
FROM core_team_members

-- Eliminate non-existing users --
INTERSECT
SELECT DISTINCT user_id
FROM core_user_action_logs

-- Extract participants --
EXCEPT
SELECT      DISTINCT user_id
FROM        core_user_action_logs
WHERE       uri LIKE '%admin%'
)

ORDER BY user_id ASC

----------------------------------------------------------------------------------
-- Match groups to programs --
SELECT core_team_members.team_id, core_team_members.user_id, core_team_members.created, core_teams.program_id
FROM core_team_members, core_teams

WHERE core_team_members.team_id IN
(
SELECT id
FROM core_teams
)
AND
core_team_members.team_id = core_teams.id
ORDER BY core_team_members.team_id
